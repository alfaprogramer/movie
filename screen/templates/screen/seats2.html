
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="{% static 'screen/styles.css' %}" rel="stylesheet">
    <link rel="icon" href="{% static 'screen/sfavicon.png'%}">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>

<body class="bodyseats-2">
<div class="inforow">
<div class="infodiv-2">
Screen
<p> Movie name: {{ movie_name }}<br>
City: {{ city_name }}<br>
Cinema hall: {{ cinema_hall.name }}<br>
Show timings: {{ show.timings }}<br>
Date: {{ show.date }} <br>
</p>


</div>
<div class="S-book-button2" id="book-button">
            Book Now
        </div>
</div>


<div class="block">

<div class="S-row">
<div class="seat" data-seat="E1">E1 <br> ₹240</div>
<div class="seat" data-seat="E2">E2 <br> ₹240</div>
<div class="seat" data-seat="E3">E3 <br> ₹240</div>
<div class="seat" data-seat="E4">E4 <br> ₹240</div>
<div class="seat" data-seat="E5">E5 <br> ₹240</div>
<div class="seat" data-seat="E6">E6 <br> ₹240</div>
<div class="seat" data-seat="E7">E7 <br> ₹240</div>
<div class="seat" data-seat="E8">E8 <br> ₹240</div>
<div class="seat" data-seat="E9">E9 <br> ₹240</div>
<div class="seat" data-seat="E10">E10 <br> ₹240</div>
<div class="seat" data-seat="E11">E11 <br> ₹240</div>
<div class="seat" data-seat="E12">E12 <br> ₹240</div>
<div class="seat" data-seat="E13">E13 <br> ₹240</div>
<div class="seat" data-seat="E14">E14 <br> ₹240</div>
<div class="seat" data-seat="E15">E15 <br> ₹240</div>
<div class="seat" data-seat="E16">E16 <br> ₹240</div>
<div class="seat" data-seat="E17">E17 <br> ₹240</div>
<div class="seat" data-seat="E18">E18 <br> ₹240</div>
<div class="seat" data-seat="E19">E19 <br> ₹240</div>
<div class="seat" data-seat="E20">E20 <br> ₹240</div>
</div>
<div class="S-row">
<div class="seat" data-seat="D1">D1 <br> ₹150</div>
<div class="seat" data-seat="D2">D2 <br> ₹150</div>
<div class="seat" data-seat="D3">D3 <br> ₹150</div>
<div class="seat" data-seat="D4">D4 <br> ₹150</div>
<div class="seat" data-seat="D5">D5 <br> ₹150</div>
<div class="seat" data-seat="D6">D6 <br> ₹150</div>
<div class="seat" data-seat="D7">D7 <br> ₹150</div>
<div class="seat" data-seat="D8">D8 <br> ₹150</div>
<div class="seat" data-seat="D9">D9 <br> ₹150</div>
<div class="seat" data-seat="D10">D10 <br> ₹150</div>
<div class="seat" data-seat="D11">D11 <br> ₹150</div>
<div class="seat" data-seat="D12">D12 <br> ₹150</div>
<div class="seat" data-seat="D13">D13 <br> ₹150</div>
<div class="seat" data-seat="D14">D14 <br> ₹150</div>
<div class="seat" data-seat="D15">D15 <br> ₹150</div>
<div class="seat" data-seat="D16">D16 <br> ₹150</div>
<div class="seat" data-seat="D17">D17 <br> ₹150</div>
<div class="seat" data-seat="D18">D18 <br> ₹150</div>
<div class="seat" data-seat="D19">D19 <br> ₹150</div>
<div class="seat" data-seat="D20">D20 <br> ₹150</div>
</div>

<div class="S-row">
 <div class="seat" data-seat="C1">C1 <br> ₹150</div>
<div class="seat" data-seat="C2">C2 <br> ₹150</div>
<div class="seat" data-seat="C3">C3 <br> ₹150</div>
<div class="seat" data-seat="C4">C4 <br> ₹150</div>
<div class="seat" data-seat="C5">C5 <br> ₹150</div>
<div class="seat" data-seat="C6">C6 <br> ₹150</div>
<div class="seat" data-seat="C7">C7 <br> ₹150</div>
<div class="seat" data-seat="C8">C8 <br> ₹150</div>
<div class="seat" data-seat="C9">C9 <br> ₹150</div>
<div class="seat" data-seat="C10">C10 <br> ₹150</div>
<div class="seat" data-seat="C11">C11 <br> ₹150</div>
<div class="seat" data-seat="C12">C12 <br> ₹150</div>
<div class="seat" data-seat="C13">C13 <br> ₹150</div>
<div class="seat" data-seat="C14">C14 <br> ₹150</div>
<div class="seat" data-seat="C15">C15 <br> ₹150</div>
<div class="seat" data-seat="C16">C16 <br> ₹150</div>
<div class="seat" data-seat="C17">C17 <br> ₹150</div>
<div class="seat" data-seat="C18">C18 <br> ₹150</div>
<div class="seat" data-seat="C19">C19 <br> ₹150</div>
<div class="seat" data-seat="C20">C20 <br> ₹150</div>
</div>
<div class="S-row">
<div class="seat" data-seat="B1">B1 <br> ₹150</div>
<div class="seat" data-seat="B2">B2 <br> ₹150</div>
<div class="seat" data-seat="B3">B3 <br> ₹150</div>
<div class="seat" data-seat="B4">B4 <br> ₹150</div>
<div class="seat" data-seat="B5">B5 <br> ₹150</div>
<div class="seat" data-seat="B6">B6 <br> ₹150</div>
<div class="seat" data-seat="B7">B7 <br> ₹150</div>
<div class="seat" data-seat="B8">B8 <br> ₹150</div>
<div class="seat" data-seat="B9">B9 <br> ₹150</div>
<div class="seat" data-seat="B10">B10 <br> ₹150</div>
<div class="seat" data-seat="B11">B11 <br> ₹150</div>
<div class="seat" data-seat="B12">B12 <br> ₹150</div>
<div class="seat" data-seat="B13">B13 <br> ₹150</div>
<div class="seat" data-seat="B14">B14 <br> ₹150</div>
<div class="seat" data-seat="B15">B15<br> ₹150</div>
<div class="seat" data-seat="B16">B16 <br> ₹150</div>
<div class="seat" data-seat="B17">B17<br> ₹150</div>
<div class="seat" data-seat="B18">B18 <br> ₹150</div>
<div class="seat" data-seat="B19">B19 <br> ₹150</div>
<div class="seat" data-seat="B20">B20 <br> ₹150</div>
</div>
<div class="S-row">
<div class="seat" data-seat="A1">A1 <br> ₹150</div>
<div class="seat" data-seat="A2">A2 <br> ₹150</div>
<div class="seat" data-seat="A3">A3 <br> ₹150</div>
<div class="seat" data-seat="A4">A4 <br> ₹150</div>
<div class="seat" data-seat="A5">A5 <br> ₹150</div>
<div class="seat" data-seat="A6">A6 <br> ₹150</div>
<div class="seat" data-seat="A7">A7 <br> ₹150</div>
<div class="seat" data-seat="A8">A8 <br> ₹150</div>
<div class="seat" data-seat="A9">A9 <br> ₹150</div>
<div class="seat" data-seat="A10">A10 <br> ₹150</div>
<div class="seat" data-seat="A11">A11 <br> ₹150</div>
<div class="seat" data-seat="A12">A12 <br> ₹150</div>
<div class="seat" data-seat="A13">A13 <br> ₹150</div>
<div class="seat" data-seat="A14">A14 <br> ₹150</div>
<div class="seat" data-seat="A15">A15<br> ₹150</div>
<div class="seat" data-seat="A16">A16 <br> ₹150</div>
<div class="seat" data-seat="A17">A17<br> ₹150</div>
<div class="seat" data-seat="A18">A18 <br> ₹150</div>
<div class="seat" data-seat="A19">A19 <br> ₹150</div>
<div class="seat" data-seat="A20">A20 <br> ₹150</div>
</div>
 

 

<div class="line2">
</div>
<div class="text2">
    Screen this way 
</div>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Replace seat prices dynamically
    $('.seat').each(function() {
        const seatText = $(this).html(); // Get the HTML content of the seat element
        const seatLabel = seatText.split('<br>')[0]; // Extract the seat label
        const seatPrice = parseInt(seatText.split('₹')[1]); // Extract the price from the HTML content

        // Find the corresponding price range from the model
        let newPrice;
        if (seatPrice === 150) {
            newPrice = '{{ show.minP|stringformat:".0f" }}'; // Replace with the minP value from the context
        } else if (seatPrice === 240) {
            newPrice = '{{ show.maxP|stringformat:".0f" }}'; // Replace with the avgP value from the context
        } else {
            newPrice = seatPrice; // Keep the original price if it doesn't match any condition
        }

        // Update the seat element with the new price
        $(this).html(`${seatLabel}<br>₹${newPrice}`);
    });
});





document.addEventListener("DOMContentLoaded", function() {
    const seats = document.querySelectorAll('.seat');
    const bookButton = document.getElementById('book-button');

    seats.forEach(seat => {
        seat.addEventListener('click', function() {
            this.classList.toggle('selected');
            updateBookButtonVisibility();
        });
    });

    bookButton.addEventListener('click', function() {
        const selectedSeats = document.querySelectorAll('.seat.selected');
        if (selectedSeats.length > 0) {
            const selectedSeatNumbers = Array.from(selectedSeats).map(seat => seat.textContent.split('<br>')[0].trim());
            const movieName = "{{ movie_name }}";
            const cityName = "{{ city_name }}";
            const cinemaHallName = "{{ cinema_hall.name }}";
            const date = "{{ show.date }}";
            const timings = "{{ show.timings }}";
            const showId = "{{ show.id }}"; // Get the show_id from the template
            const cinemaHallId = "{{ cinema_hall.id }}"; // Get the cinema_hall_id from the template
            const imageUrl = getUrlParameter('image'); // Get image URL from URL parameters

            // Construct the query string with all parameters including the image URL
            const queryString = `?movie=${encodeURIComponent(movieName)}&city=${encodeURIComponent(cityName)}&cinema_hall=${encodeURIComponent(cinemaHallName)}&date=${encodeURIComponent(date)}&timings=${encodeURIComponent(timings)}&seats=${encodeURIComponent(selectedSeatNumbers.join(','))}&image=${encodeURIComponent(imageUrl)}&show_id=${encodeURIComponent(showId)}&cinema_hall_id=${encodeURIComponent(cinemaHallId)}`;

            // Redirect to the booking page with the constructed query string
            window.location.href = "{% url 'book' %}" + queryString;
        }
    });

    function updateBookButtonVisibility() {
        const selectedSeats = document.querySelectorAll('.seat.selected');
        if (selectedSeats.length > 0) {
            bookButton.style.display = 'block';
        } else {
            bookButton.style.display = 'none';
        }
    }

    // Function to get URL parameters by name
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        const results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
});






document.addEventListener("DOMContentLoaded", function() {
    const queryParams = new URLSearchParams(window.location.search);
    const showId = queryParams.get('show_id');
    const cinemaHallId = queryParams.get('cinema_hall_id');
    const movieName = queryParams.get('movie_name');
    const cityName = queryParams.get('city_name');

    console.log(`Fetching data for show_id=${showId}, cinema_hall_id=${cinemaHallId}, movie_name=${movieName}, city_name=${cityName}`);

    fetch(`/api/seats2/?show_id=${showId}&cinema_hall_id=${cinemaHallId}&movie_name=${encodeURIComponent(movieName)}&city_name=${encodeURIComponent(cityName)}`)
        .then(response => response.json())
        .then(data => {
            console.log('Data received:', data);
            const bookedSeats = data.booked_seats;
            applyStylingToBookedSeats(bookedSeats);
        })
        .catch(error => console.error('Error retrieving booked seats:', error));

    function applyStylingToBookedSeats(bookedSeats) {
        console.log('Applying styling to booked seats:', bookedSeats);
        bookedSeats.forEach(seatNumber => {
            const bookedSeat = document.querySelector(`.seat[data-seat="${seatNumber}"]`);
            if (bookedSeat) {
                console.log(`Booking seat: ${seatNumber}`);
                bookedSeat.classList.add('booked');
            } else {
                console.log(`Seat ${seatNumber} not found.`);
            }
        });
    }
});


</script>
</body>

