{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theater Seating</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="{% static 'screen/styles.css' %}" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="{% static 'screen/sfavicon.png'%}">
</head>
<body class="seatbody">
<div class="S-container">
<div class="S-infodiv">
Screen
   <p> 
        Movie name: {{ movie_name }} <br>
        City: {{ city_name }} <br>
        Cinema hall: {{ cinema_hall.name }} <br>
        Date: {{ show.date }} <br>
        Show timings: {{ show.timings }} <br>
        <!-- Add other relevant show information here -->
    </p>
   <div class="S-book-button" id="book-button">
    Book Now
</div>
</div>




<div class="xo">
<div class="main-container">
<div class="themain">
    <div class="S-part1">
        <div class="S-i1">
              <div class="seat" data-seat="J1">J1 <br> ₹200</div>
              <div class="seat" data-seat="J2">J2<br> ₹200</div>
              <div class="seat" data-seat="J3">J3<br> ₹200</div>
              <div class="seat" data-seat="J4">J4<br> ₹200</div>
              <div class="seat" data-seat="J5">J5<br> ₹200</div>
        </div>

        <div class="S-i1">
                    <div class="seat" data-seat="I1">I1<br> ₹200</div>
                    <div class="seat" data-seat="I2">I2<br> ₹200</div>
                    <div class="seat" data-seat="I3">I3<br> ₹200</div>
                    <div class="seat" data-seat="I4">I4<br> ₹200</div>
                    <div class="seat" data-seat="I5">I5<br> ₹200</div>
        </div>

    </div>


    <div class="S-part2">
        <div class="S-i1">
            <div class="seat" data-seat="J6">J6<br> ₹200</div>
                    <div class="seat" data-seat="J7">J7<br> ₹200</div>
                    <div class="seat" data-seat="J8">J8<br> ₹200</div>
                    <div class="seat" data-seat="J9">J9<br> ₹200</div>
                    <div class="seat" data-seat="J10">J10<br> ₹200</div>
        </div>

        <div class="S-i1">
           <div class="seat" data-seat="I6">I6<br> ₹200</div>
                    <div class="seat" data-seat="I7">I7<br> ₹200</div>
                    <div class="seat" data-seat="I8">I8<br> ₹200</div>
                    <div class="seat" data-seat="I9">I9<br> ₹200</div>
                    <div class="seat" data-seat="I10">I10<br> ₹200</div>
        </div>

    </div>

</div>  
</div>  

<div class="thecart"> 
    <div class="S-i2">
          <div class="seat" data-seat="H1">H1<br> ₹170</div>
            <div class="seat" data-seat="H2">H2<br> ₹170</div>
            <div class="seat" data-seat="H3">H3<br> ₹170</div>
            <div class="seat" data-seat="H4">H4<br> ₹170</div>
            <div class="seat" data-seat="H5">H5<br> ₹170</div>
            <div class="seat" data-seat="H6">H6<br> ₹170</div>
            <div class="seat" data-seat="H7">H7<br> ₹170</div>
            <div class="seat" data-seat="H8">H8<br> ₹170</div>
            <div class="seat" data-seat="H9">H9<br> ₹170</div>
            <div class="seat" data-seat="H10">H10<br> ₹170</div>
    </div>

    <div class="S-i2">
       <div class="seat" data-seat="G1">G1<br> ₹170</div>
            <div class="seat" data-seat="G2">G2<br> ₹170</div>
            <div class="seat" data-seat="G3">G3<br> ₹170</div>
            <div class="seat" data-seat="G4">G4<br> ₹170</div>
            <div class="seat" data-seat="G5">G5<br> ₹170</div>
            <div class="seat" data-seat="G6">G6<br> ₹170</div>
            <div class="seat" data-seat="G7">G7<br> ₹170</div>
            <div class="seat" data-seat="G8">G8<br> ₹170</div>
            <div class="seat" data-seat="G9">G9<br> ₹170</div>
            <div class="seat" data-seat="G10">G10<br> ₹170</div>
    </div>


    <div class="S-i2">
        <div class="seat" data-seat="F1">F1<br> ₹170</div>
            <div class="seat" data-seat="F2">F2<br> ₹170</div>
            <div class="seat" data-seat="F3">F3<br> ₹170</div>
            <div class="seat" data-seat="F4">F4<br> ₹170</div>
            <div class="seat" data-seat="F5">F5<br> ₹170</div>
            <div class="seat" data-seat="F6">F6<br> ₹170</div>
            <div class="seat" data-seat="F7">F7<br> ₹170</div>
            <div class="seat" data-seat="F8">F8<br> ₹170</div>
            <div class="seat" data-seat="F9">F9<br> ₹170</div>
            <div class="seat" data-seat="F10">F10<br> ₹170</div>
    </div>




</div>





<div class="thecart"> 
    <div class="S-i2">
       <div class="seat" data-seat="E1">E1<br> ₹120</div>
            <div class="seat" data-seat="E2">E2<br> ₹120</div>
            <div class="seat" data-seat="E3">E3<br> ₹120</div>
            <div class="seat" data-seat="E4">E4<br> ₹120</div>
            <div class="seat" data-seat="E5">E5<br> ₹120</div>
            <div class="seat" data-seat="E6">E6<br> ₹120</div>
            <div class="seat" data-seat="E7">E7<br> ₹120</div>
            <div class="seat" data-seat="E8">E8<br> ₹120</div>
            <div class="seat" data-seat="E9">E9<br> ₹120</div>
            <div class="seat" data-seat="E10">E10<br> ₹120</div>

    </div>
    <div class="S-i2">
        <div class="seat" data-seat="D1">D1<br> ₹120</div>
            <div class="seat" data-seat="D2">D2<br> ₹120</div>
            <div class="seat" data-seat="D3">D3<br> ₹120</div>
            <div class="seat" data-seat="D4">D4<br> ₹120</div>
            <div class="seat" data-seat="D5">D5<br> ₹120</div>
            <div class="seat" data-seat="D6">D6<br> ₹120</div>
            <div class="seat" data-seat="D7">D7<br> ₹120</div>
            <div class="seat" data-seat="D8">D8<br> ₹120</div>
            <div class="seat" data-seat="D9">D9<br> ₹120</div>
            <div class="seat" data-seat="D10">D10<br> ₹120</div>

    </div>
    <div class="S-i2">
          <div class="seat" data-seat="C1">C1<br> ₹120</div>
            <div class="seat" data-seat="C2">C2<br> ₹120</div>
            <div class="seat" data-seat="C3">C3<br> ₹120</div>
            <div class="seat" data-seat="C4">C4<br> ₹120</div>
            <div class="seat" data-seat="C5">C5<br> ₹120</div>
            <div class="seat" data-seat="C6">C6<br> ₹120</div>
            <div class="seat" data-seat="C7">C7<br> ₹120</div>
            <div class="seat" data-seat="C8">C8<br> ₹120</div>
            <div class="seat" data-seat="C9">C9<br> ₹120</div>
            <div class="seat" data-seat="C10">C10<br> ₹120</div>

    </div>

      <div class="S-i2">
       <div class="seat" data-seat="B1">B1<br> ₹120</div>
            <div class="seat" data-seat="B2">B2<br> ₹120</div>
            <div class="seat" data-seat="B3">B3<br> ₹120</div>
            <div class="seat" data-seat="B4">B4<br> ₹120</div>
            <div class="seat" data-seat="B5">B5<br> ₹120</div>
            <div class="seat" data-seat="B6">B6<br> ₹120</div>
            <div class="seat" data-seat="B7">B7<br> ₹120</div>
            <div class="seat" data-seat="B8">B8<br> ₹120</div>
            <div class="seat" data-seat="B9">B9<br> ₹120</div>
            <div class="seat" data-seat="B10">B10<br> ₹120</div>

    </div>

      <div class="S-i2">
         <div class="seat" data-seat="A1">A1<br> ₹120</div>
            <div class="seat" data-seat="A2">A2<br> ₹120</div>
            <div class="seat" data-seat="A3">A3<br> ₹120</div>
            <div class="seat" data-seat="A4">A4<br> ₹120</div>
            <div class="seat" data-seat="A5">A5<br> ₹120</div>
            <div class="seat" data-seat="A6">A6<br> ₹120</div>
            <div class="seat" data-seat="A7">A7<br> ₹120</div>
            <div class="seat" data-seat="A8">A8<br> ₹120</div>
            <div class="seat" data-seat="A9">A9<br> ₹120</div>
            <div class="seat" data-seat="A10">A10<br> ₹120</div>

    </div>


</div>

<div class="line">
</div>
<div class="text">



    Screen this way 



</div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Replace seat prices dynamically
    $('.seat').each(function() {
        const seatText = $(this).html(); // Get the HTML content of the seat element
        const seatLabel = seatText.split('<br>')[0]; // Extract the seat label
        const seatPrice = parseInt(seatText.split('₹')[1]); // Extract the price from the HTML content

        // Find the corresponding price range from the model
        let newPrice;
        if (seatPrice === 120) {
            newPrice = '{{ show.minP|stringformat:".0f" }}'; // Replace with the minP value from the context
        } else if (seatPrice === 170) {
            newPrice = '{{ show.avgP|stringformat:".0f" }}'; // Replace with the avgP value from the context
        } else if (seatPrice === 200) {
            newPrice = '{{ show.maxP|stringformat:".0f" }}'; // Replace with the maxP value from the context
        } else {
            newPrice = seatPrice; // Keep the original price if it doesn't match any condition
        }

        // Update the seat element with the new price
        $(this).html(`${seatLabel}<br>₹${newPrice}`);
    });
});





document.addEventListener("DOMContentLoaded", function() {
    const seats = document.querySelectorAll('.seat');
    const bookButton = document.getElementById('book-button');

    seats.forEach(seat => {
        seat.addEventListener('click', function() {
            this.classList.toggle('selected');
            updateBookButtonVisibility();
        });
    });

  bookButton.addEventListener('click', function() {
    const selectedSeats = document.querySelectorAll('.seat.selected');
    if (selectedSeats.length > 0) {
        const selectedSeatNumbers = Array.from(selectedSeats).map(seat => seat.textContent.split('<br>')[0].trim());
        const movieName = "{{ movie_name }}";
        const cityName = "{{ city_name }}";
        const cinemaHallName = "{{ cinema_hall.name }}";
        const date = "{{ show.date }}";
        const timings = "{{ show.timings }}";
        const showId = "{{ show.id }}"; // Get the show_id from the template
        const cinemaHallId = "{{ cinema_hall.id }}"; // Get the cinema_hall_id from the template
        const imageUrl = getUrlParameter('image'); // Get image URL from URL parameters

        // Construct the query string with all parameters including the image URL, show_id, and cinema_hall_id
        const queryString = `?movie=${encodeURIComponent(movieName)}&city=${encodeURIComponent(cityName)}&cinema_hall=${encodeURIComponent(cinemaHallName)}&date=${encodeURIComponent(date)}&timings=${encodeURIComponent(timings)}&seats=${encodeURIComponent(selectedSeatNumbers.join(','))}&image=${encodeURIComponent(imageUrl)}&show_id=${encodeURIComponent(showId)}&cinema_hall_id=${encodeURIComponent(cinemaHallId)}`;

        // Redirect to the booking page with the constructed query string
        window.location.href = "{% url 'book' %}" + queryString;
    }
});

    function updateBookButtonVisibility() {
        const selectedSeats = document.querySelectorAll('.seat.selected');
        if (selectedSeats.length > 0) {
            bookButton.style.display = 'block';
        } else {
            bookButton.style.display = 'none';
        }
    }

    // Function to get URL parameters by name
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        const results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
});






document.addEventListener("DOMContentLoaded", function() {
    const queryParams = new URLSearchParams(window.location.search);
    const showId = queryParams.get('show_id');
    const cinemaHallId = queryParams.get('cinema_hall_id');
    const movieName = queryParams.get('movie_name');
    const cityName = queryParams.get('city_name');

    console.log(`Fetching data for show_id=${showId}, cinema_hall_id=${cinemaHallId}, movie_name=${movieName}, city_name=${cityName}`);

    fetch(`/api/seats/?show_id=${showId}&cinema_hall_id=${cinemaHallId}&movie_name=${encodeURIComponent(movieName)}&city_name=${encodeURIComponent(cityName)}`)
        .then(response => response.json())
        .then(data => {
            console.log('Data received:', data);
            const bookedSeats = data.booked_seats;
            applyStylingToBookedSeats(bookedSeats);
        })
        .catch(error => console.error('Error retrieving booked seats:', error));

    function applyStylingToBookedSeats(bookedSeats) {
        console.log('Applying styling to booked seats:', bookedSeats);
        bookedSeats.forEach(seatNumber => {
            const bookedSeat = document.querySelector(`.seat[data-seat="${seatNumber}"]`);
            if (bookedSeat) {
                console.log(`Booking seat: ${seatNumber}`);
                bookedSeat.classList.add('booked');
            } else {
                console.log(`Seat ${seatNumber} not found.`);
            }
        });
    }
});










  
</script>

</body>
</html>
