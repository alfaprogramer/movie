{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theater Seating</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="{% static 'screen/styles.css' %}" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body class="seatbody">
<div class="S-container">
<div class="S-infodiv">
Screen
   <p> 
        Movie name: {{ movie_name }} <br>
        City: {{ city_name }} <br>
        Cinema hall: {{ cinema_hall.name }} <br>
        Date: {{ show.date }} <br>
        Show timings: {{ show.timings }} <br>
        <!-- Add other relevant show information here -->
    </p>
   <div class="S-book-button" id="book-button">
    Book Now
</div>
</div>




<div class="xo">
<div class="main-container">
<div class="themain">
    <div class="S-part1">
        <div class="S-i1">
            <div class="seat">J1 <br> ₹200</div>
            <div class="seat">J2<br> ₹200</div>
            <div class="seat">J3<br> ₹200</div>
            <div class="seat">J4<br> ₹200</div>
            <div class="seat">J5<br> ₹200</div>
        </div>

        <div class="S-i1">
            <div class="seat">I1<br> ₹200</div>
            <div class="seat">I2<br> ₹200</div>
            <div class="seat">I3<br> ₹200</div>
            <div class="seat">I4<br> ₹200</div>
            <div class="seat">I5<br> ₹200</div>
        </div>

    </div>


    <div class="S-part2">
        <div class="S-i1">
            <div class="seat">J6<br> ₹200</div>
            <div class="seat">J7<br> ₹200</div>
            <div class="seat">J8<br> ₹200</div>
            <div class="seat">J9<br> ₹200</div>
            <div class="seat">J10<br> ₹200</div>
        </div>

        <div class="S-i1">
            <div class="seat">I6<br> ₹200</div>
            <div class="seat">I7<br> ₹200</div>
            <div class="seat">I8<br> ₹200</div>
            <div class="seat">I8<br> ₹200</div>
            <div class="seat">I10<br> ₹200</div>
        </div>

    </div>

</div>  
</div>  

<div class="thecart"> 
    <div class="S-i2">
        <div class="seat">H1<br> ₹170</div>
        <div class="seat">H2<br> ₹170</div>
        <div class="seat">H3<br> ₹170</div>
        <div class="seat">H4<br> ₹170</div>
        <div class="seat">H5<br> ₹170</div>
        <div class="seat">H6<br> ₹170</div>
        <div class="seat">H7<br> ₹170</div>
        <div class="seat">H8<br> ₹170</div>
        <div class="seat">H9<br> ₹170</div>
        <div class="seat">H10<br> ₹170</div>
    </div>

    <div class="S-i2">
        <div class="seat">G1<br> ₹170</div>
        <div class="seat">G2<br> ₹170</div>
        <div class="seat">G3<br> ₹170</div>
        <div class="seat">G4<br> ₹170</div>
        <div class="seat">G5<br> ₹170</div>
        <div class="seat">G6<br> ₹170</div>
        <div class="seat">G7<br> ₹170</div>
        <div class="seat">G8<br> ₹170</div>
        <div class="seat">G9<br> ₹170</div>
        <div class="seat">G10<br> ₹170</div>
    </div>


    <div class="S-i2">
        <div class="seat">F1<br> ₹170</div>
        <div class="seat">F2<br> ₹170</div>
        <div class="seat">F3<br> ₹170</div>
        <div class="seat">F4<br> ₹170</div>
        <div class="seat">F5<br> ₹170</div>
        <div class="seat">F6<br> ₹170</div>
        <div class="seat">F7<br> ₹170</div>
        <div class="seat">F8<br> ₹170</div>
        <div class="seat">F9<br> ₹170</div>
        <div class="seat">F10<br> ₹170</div>
    </div>




</div>





<div class="thecart"> 
    <div class="S-i2">
        <div class="seat">E1<br> ₹120</div>
        <div class="seat">E2<br> ₹120</div>
        <div class="seat">E3<br> ₹120</div>
        <div class="seat">E4<br> ₹120</div>
        <div class="seat">E5<br> ₹120</div>
        <div class="seat">E6<br> ₹120</div>
        <div class="seat">E7<br> ₹120</div>
        <div class="seat">E8<br> ₹120</div>
        <div class="seat">E9<br> ₹120</div>
        <div class="seat">E10<br> ₹120</div>

    </div>
    <div class="S-i2">
        <div class="seat">D1<br> ₹120</div>
        <div class="seat">D2<br> ₹120</div>
        <div class="seat">D3<br> ₹120</div>
        <div class="seat">D4<br> ₹120</div>
        <div class="seat">D5<br> ₹120</div>
        <div class="seat">D6<br> ₹120</div>
        <div class="seat">D7<br> ₹120</div>
        <div class="seat">D8<br> ₹120</div>
        <div class="seat">D9<br> ₹120</div>
        <div class="seat">D10<br> ₹120</div>

    </div>
    <div class="S-i2">
        <div class="seat">C1<br> ₹120</div>
        <div class="seat">C2<br> ₹120</div>
        <div class="seat">C3<br> ₹120</div>
        <div class="seat">C4<br> ₹120</div>
        <div class="seat">C5<br> ₹120</div>
        <div class="seat">C6<br> ₹120</div>
        <div class="seat">C7<br> ₹120</div>
        <div class="seat">C8<br> ₹120</div>
        <div class="seat">C9<br> ₹120</div>
        <div class="seat">C10<br> ₹120</div>

    </div>

      <div class="S-i2">
        <div class="seat">B1<br> ₹120</div>
        <div class="seat">B2<br> ₹120</div>
        <div class="seat">B3<br> ₹120</div>
        <div class="seat">B4<br> ₹120</div>
        <div class="seat">B5<br> ₹120</div>
        <div class="seat">B6<br> ₹120</div>
        <div class="seat">B7<br> ₹120</div>
        <div class="seat">B8<br> ₹120</div>
        <div class="seat">B9<br> ₹120</div>
        <div class="seat">B10<br> ₹120</div>

    </div>

      <div class="S-i2">
        <div class="seat">A1<br> ₹120</div>
        <div class="seat">A2<br> ₹120</div>
        <div class="seat">A3<br> ₹120</div>
        <div class="seat">A4<br> ₹120</div>
        <div class="seat">A5<br> ₹120</div>
        <div class="seat">A6<br> ₹120</div>
        <div class="seat">A7<br> ₹120</div>
        <div class="seat">A8<br> ₹120</div>
        <div class="seat">A9<br> ₹120</div>
        <div class="seat">A10<br> ₹120</div>

    </div>


</div>

<div class="line">
</div>
<div class="text">



    Screen this way 



</div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Replace seat prices dynamically
    $('.seat').each(function() {
        const seatText = $(this).html(); // Get the HTML content of the seat element
        const seatLabel = seatText.split('<br>')[0]; // Extract the seat label
        const seatPrice = parseInt(seatText.split('₹')[1]); // Extract the price from the HTML content

        // Find the corresponding price range from the model
        let newPrice;
        if (seatPrice === 120) {
            newPrice = '{{ show.minP|stringformat:".0f" }}'; // Replace with the minP value from the context
        } else if (seatPrice === 170) {
            newPrice = '{{ show.avgP|stringformat:".0f" }}'; // Replace with the avgP value from the context
        } else if (seatPrice === 200) {
            newPrice = '{{ show.maxP|stringformat:".0f" }}'; // Replace with the maxP value from the context
        } else {
            newPrice = seatPrice; // Keep the original price if it doesn't match any condition
        }

        // Update the seat element with the new price
        $(this).html(`${seatLabel}<br>₹${newPrice}`);
    });
});





document.addEventListener("DOMContentLoaded", function() {
    const seats = document.querySelectorAll('.seat');
    const bookButton = document.getElementById('book-button');

    seats.forEach(seat => {
        seat.addEventListener('click', function() {
            this.classList.toggle('selected');
            updateBookButtonVisibility();
        });
    });

    bookButton.addEventListener('click', function() {
        const selectedSeats = document.querySelectorAll('.seat.selected');
        if (selectedSeats.length > 0) {
            const selectedSeatNumbers = Array.from(selectedSeats).map(seat => seat.textContent.split('<br>')[0].trim());
            const movieName = "{{ movie_name }}";
            const cityName = "{{ city_name }}";
            const cinemaHallName = "{{ cinema_hall.name }}";
            const date = "{{ show.date }}";
            const timings = "{{ show.timings }}";
            const imageUrl = getUrlParameter('image'); // Get image URL from URL parameters

            // Construct the query string with all parameters including the image URL
            const queryString = `?movie=${encodeURIComponent(movieName)}&city=${encodeURIComponent(cityName)}&cinema_hall=${encodeURIComponent(cinemaHallName)}&date=${encodeURIComponent(date)}&timings=${encodeURIComponent(timings)}&seats=${encodeURIComponent(selectedSeatNumbers.join(','))}&image=${encodeURIComponent(imageUrl)}`;

            // Redirect to the booking page with the constructed query string
            window.location.href = "{% url 'book' %}" + queryString;
        }
    });

    function updateBookButtonVisibility() {
        const selectedSeats = document.querySelectorAll('.seat.selected');
        if (selectedSeats.length > 0) {
            bookButton.style.display = 'block';
        } else {
            bookButton.style.display = 'none';
        }
    }

    // Function to get URL parameters by name
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        const results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
});






document.addEventListener("DOMContentLoaded", function() {
    fetch('/get-selected-seats')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
       .then(data => {
    console.log('Retrieved data:', data);
    const selectedSeats = data.selected_seats.split(',');
    applyStylingToSelectedSeats(selectedSeats);
})
        .catch(error => console.error('Error retrieving selected seats:', error));

    function applyStylingToSelectedSeats(selectedSeats) {
        selectedSeats.forEach(seatNumber => {
            const selectedSeat = document.querySelector(`.seat[data-seat="${seatNumber}"]`);
            if (selectedSeat) {
                selectedSeat.classList.add('selected');
                selectedSeat.classList.add('unselectable');
            } else {
                console.error(`Seat ${seatNumber} not found`);
            }
        });
    }
});










  
</script>

</body>
</html>
